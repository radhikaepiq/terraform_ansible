pipeline {
    agent any
    environment
	{
	awscredential = credentials("sayalim-creds")
	}
    parameters {
        booleanParam(name: 'ClusterPlan', description: 'Planning EKS Cluster')
        booleanParam(name: 'ClusterCreate', description: 'Creating EKS Cluster')
        booleanParam(name: 'ClusterDestroy', description: 'Destroy Cluster')
    }
    stages {
        stage('Initiating Terraform configuration')
        {
            steps {
                sh ('terraform init -no-color')
                }
            }
        stage('Planning Cluster') {
            when
		    {
		        expression{"${params.ClusterPlan}"=="true"}
		    }
            steps {
                sh ('terraform plan --var-file ap-south-1.tfvars -no-color')
            }
        }
        stage('Creating Cluster') {
            when
		    {
		        expression{"${params.ClusterCreate}"=="true"}
		    }
            steps {
                sh ('terraform apply --var-file ap-south-1.tfvars --auto-approve -no-color')
            }
        }
        stage('Destroy Cluster') {
            when
            {
                expression{"${params.ClusterDestroy}"=="true"}
            }
            steps {
                sh  'terraform destroy --var-file ap-south-1.tfvars --auto-approve -no-color'
            }
        }
    }
}   